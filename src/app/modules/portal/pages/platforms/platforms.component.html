<app-header-title
  hTitle="Plataformas"
  hDescription="Listado de todas las plataformas con sus saldos del día"
  hDescriptionSecondLine="Eres libre de editarlos y añadir transferencias"
></app-header-title>
<section class="w-full grid grid-cols-3 gap-x-5">
  <article class="card col-span-1">
    <header class="h-12 mb-2 flex items-center justify-center">
      <input
        class="input w-full"
        type="search"
        id="search-platform"
        placeholder="Buscar plataforma"
      />
    </header>
    <ul class="flex flex-col gap-1">
      <li
        *ngFor="let platform of platforms(); index as i"
        class="text-gray-800 text-lg px-2 py-1 rounded-md cursor-pointer hover:bg-violet-100"
        [ngClass]="i == selectedPlatformIndex() ? 'bg-violet-100' : ''"
        (click)="onSelectPlatform(platform, i)"
      >
        {{ platform.platformName }}
      </li>
    </ul>
  </article>
  <article class="card col-span-2 flex items-center w-full">
    <div class="w-full">
      <header class="h-12 mb-2 flex items-center justify-center">
        <h3 class="text-2xl text-gray-800 font-semibold">
          {{
            selectedPlatformBalance()?.platformName ??
              "Selecciona una plataforma"
          }}
        </h3>
      </header>
      <ng-container *ngIf="selectedPlatformBalance()">
        <section>
          <form
            [formGroup]="balanceForm"
            (ngSubmit)="onBalancesSubmit()"
            class="form"
            *ngIf="editingBalances(); else platform_info"
          >
            <div class="control">
              <label for="initialBalance">Saldo Inicial</label>
              <input
                type="number"
                id="initialBalance"
                class="input"
                formControlName="initialBalance"
              />
            </div>
            <div class="control">
              <label for="finalBalance">Saldo Final</label>
              <input
                type="number"
                id="finalBalance"
                class="input"
                formControlName="finalBalance"
              />
            </div>
            <app-button type="submit">Guardar</app-button>
          </form>
          <ng-template #platform_info>
            <div class="flex flex-col gap-2.5 mb-3">
              <p class="text-gray-700 flex items-center justify-between">
                <span>Saldo Inicial</span>
                <span class="font-medium">{{
                  selectedPlatformBalance()?.initialBalance
                    | currency : "symbol" : "$" : "0.00"
                }}</span>
              </p>
              <div class="divider"></div>
              <p class="text-gray-700 flex items-center justify-between">
                <span>Saldo Final</span>
                <span class="font-medium">{{
                  selectedPlatformBalance()?.finalBalance
                    | currency : "symbol" : "$" : "0.00"
                }}</span>
              </p>
              <div class="divider"></div>
              <p class="text-gray-700 flex items-center justify-between">
                <span>Transferencias del día</span>
                <span class="font-medium">0</span>
              </p>
              <div class="divider"></div>
              <p class="text-gray-700 flex items-center justify-between">
                <span>Total transferido</span>
                <span class="font-medium">{{
                  0 | currency : "symbol" : "$" : "0.00"
                }}</span>
              </p>
            </div>
            <app-button
              type="button"
              color="neutral"
              (click)="handleEditingBalances()"
              >Editar Saldos</app-button
            >
          </ng-template>
        </section>
        <div class="divider-md my-3"></div>
        <footer class="w-full px-2.5">
          <header class="mb-1">
            <h2 class="text-gray-700 text-lg font-medium">
              Nueva transferencia
            </h2>
          </header>
          <form
            class="w-full flex flex-wrap justify-between items-center gap-3"
            [formGroup]="transferForm"
            (ngSubmit)="onTransferSubmit()"
          >
            <div>
              <label
                for="voucher"
                class="px-3 py-2 border border-gray-300 bg-gray-50 rounded-lg text-gray-700 text-sm cursor-pointer"
                >{{
                  voucherPicked()
                    ? voucherPicked()?.name
                    : "Adjuntar comprobante"
                }}</label
              >
              <input
                type="file"
                id="voucher"
                class="sr-only"
                (change)="onVoucherPicked($event)"
              />
            </div>
            <input
              type="number"
              id="transfer-value"
              placeholder="10000"
              class="input"
              formControlName="value"
            />
            <button
              type="submit"
              class="cursor-pointer text-cyan-700 text-lg hover:text-cyan-600 hover:underline hover:underline-offset-2"
            >
              Añadir transferencia
            </button>
          </form>
        </footer>
      </ng-container>
    </div>
  </article>
</section>
